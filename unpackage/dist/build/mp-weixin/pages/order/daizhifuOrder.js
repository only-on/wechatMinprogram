(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/daizhifuOrder"],{"0445":function(t,e,o){"use strict";o.r(e);var n=o("31d2"),i=o("622d");for(var a in i)"default"!==a&&function(t){o.d(e,t,(function(){return i[t]}))}(a);o("9279");var c,s=o("f0c5"),u=Object(s["a"])(i["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],c);e["default"]=u.exports},"0fc1":function(t,e,o){"use strict";(function(t){o("c6bf"),o("921b");n(o("66fd"));var e=n(o("0445"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},"31d2":function(t,e,o){"use strict";var n,i=function(){var t=this,e=t.$createElement;t._self._c},a=[];o.d(e,"b",(function(){return i})),o.d(e,"c",(function(){return a})),o.d(e,"a",(function(){return n}))},"622d":function(t,e,o){"use strict";o.r(e);var n=o("b1c4"),i=o.n(n);for(var a in n)"default"!==a&&function(t){o.d(e,t,(function(){return n[t]}))}(a);e["default"]=i.a},9279:function(t,e,o){"use strict";var n=o("f08f"),i=o.n(n);i.a},b1c4:function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=i(o("4795"));function i(t){return t&&t.__esModule?t:{default:t}}function a(t,e,o,n,i,a,c){try{var s=t[a](c),u=s.value}catch(r){return void o(r)}s.done?e(u):Promise.resolve(u).then(n,i)}function c(t){return function(){var e=this,o=arguments;return new Promise((function(n,i){var c=t.apply(e,o);function s(t){a(c,n,i,s,u,"next",t)}function u(t){a(c,n,i,s,u,"throw",t)}s(void 0)}))}}var s=function(){o.e("components/uni-number-box/uni-number-box").then(function(){return resolve(o("8ae1"))}.bind(null,o)).catch(o.oe)},u=function(){o.e("components/uni-section/uni-section").then(function(){return resolve(o("8a21"))}.bind(null,o)).catch(o.oe)};function r(t){var e=new Date,o=e.getFullYear(),n=e.getMonth()+1,i=e.getDate();return"start"===t||"end"===t&&(o+=2),n=n>9?n:"0"+n,i=i>9?i:"0"+i,"".concat(o,"-").concat(n,"-").concat(i)}var l={components:{uniNumberBox:s,uniSection:u},data:function(){return{quxiaostate:0,paystate:0,intervalID:0,havetime:"",id:"",type:0,new_type:"",youhui:0,maskState:0,desc:"",payType:1,numberValue:1,minQuantity:1,price:0,all_price:0,secondKillId:0,secondKillTimeId:0,guige_id:0,miaosha:0,buy_type:0,couponSel:"",commodity:[],total:0,goods:[],service:[],note:"",date:r({format:!0}),time:"2",startDate:r("start"),endDate:r("end"),couponList:[],addressData:{name:"添加地址",mobile:null}}},onUnload:function(){console.log("页面卸载"),clearInterval(that.intervalID)},onLoad:function(t){var e=this;e.paystate=0,e.quxiaostate=0;var o=t.id,n=t.type,i=t.guige_id;console.log(i),e.id=t.id,e.type=t.type,e.guige_id=t.guige_id,e.buy_type=t.buy_type,e.loadData(o),0==n?e.new_type=2:1==n?e.new_type=0:2==n?e.new_type=6:-1==n?1==t.buy_type?e.new_type=1:e.new_type=0:-2==n?1==t.buy_type?e.new_type=7:e.new_type=6:-3==n&&(1==t.buy_type?e.new_type=3:e.new_type=2),1==t.miaosha&&(e.miaosha=t.miaosha,e.secondKillId=t.secondKillId,e.secondKillTimeId=t.secondKillTimeId,console.log("is秒杀"+t.miaosha),e.new_type=5)},methods:{cancelOrder:function(){var e=this;1!=e.quxiaostate&&(e.quxiaostate=1,t.showLoading({title:"请稍后"}),t.request({url:e.$api_url+"/order/cancel",header:{"Content-Type":"application/x-www-form-urlencoded",authorization:t.getStorageSync("authorization")},method:"POST",data:{orderNo:e.goods.number},success:function(o){e.quxiaostate=0,t.navigateBack({delta:2})},complete:function(o){e.quxiaostate=0,t.hideLoading()}}))},change:function(t){console.log(t),this.numberValue=t,this.all_price=this.price*t,this.countTotal()},loadData:function(t){var e=this;return c(n.default.mark((function t(){return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e,e.loadGoodsInfo();case 2:case"end":return t.stop()}}),t)})))()},selAddress:function(){var e=this;t.chooseAddress({success:function(o){e.addressData=o,e.goods.pickUp&&(e.addressData.provinceName=e.goods.pickUpAddress,e.addressData.cityName="",e.addressData.detailInfo="",t.showModal({title:"提示",content:"该商品为自提，请注意自提地址！",showCancel:!1,success:function(t){}})),console.log(o.userName),console.log(o.postalCode),console.log(o.provinceName),console.log(o.cityName),console.log(o.countyName),console.log(o.detailInfo),console.log(o.nationalCode),console.log(o.telNumber)}})},nobonus:function(){this.selCouponName="选择优惠券",this.couponSel="",this.maskState=0,this.youhui=0,this.all_price=this.price*this.numberValue,this.countTotal()},loadGoodsInfo:function(){var e=this,o=this;console.log("this.miaosha=="+o.miaosha);var n="order/detail",i={orderId:o.id},a=this.$Request.topost(n,i);a.then((function(n){if(console.log(n),1e3==n.code){o.goods=n.content;var i=new Date(e.goods.createTime).getTime()+864e5;console.log(i);var a=(new Date).getTime();console.log(a),e.havetime=Math.floor((i-a)/1e3/3600)+"小时"+Math.floor((i-a)/1e3%3600/60),console.log(e.havetime),0!=o.type?(console.log(o.guige_id),o.commodity=n.content.commodityList[o.guige_id],o.minQuantity=n.content.commodityList[o.guige_id].minQuantity,1==o.buy_type?o.price=o.commodity.groupBuyPrice:1==o.miaosha?o.price=o.commodity.secondKillPrice:o.price=o.commodity.price):(o.minQuantity=1,o.price=n.content.discountPrice),o.countTotal(),o.goods=n.content,o.$Request.topost(o.$api.order.bonus_list,{productId:o.id,price:o.price*o.minQuantity}).then((function(t){1e3==t.code&&(o.couponList=t.content)})),o.$Request.topost(o.$api.order.bonus_best,{productId:o.id,price:o.price*o.minQuantity}).then((function(t){1e3==t.code&&(o.couponSel=t.content.id,o.youhui=t.content.money,o.selCouponName=t.content.name,o.selCoupon(t.content),o.countTotal())}))}else t.navigateBack()}))},countTotal:function(){this.price*this.numberValue>this.youhui?this.total=(this.price*this.numberValue-this.youhui).toFixed(2):this.total=0},toggleMask:function(t){var e=this,o="show"===t?10:300,n="show"===t?1:0;this.maskState=2,setTimeout((function(){e.maskState=n}),o)},selCoupon:function(t){this.youhui=t.money,this.all_price=this.price*this.numberValue,this.countTotal(),this.selCouponName=t.name+"(￥"+t.money+"元)",this.couponSel=t.id,this.maskState=0},numberChange:function(t){this.number=t.number},changePayType:function(t){this.payType=t},submit:function(){var e=this;1!=e.paystate&&(e.paystate=1,t.request({url:this.$api_url+"/weixin/payment.do",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded",authorization:t.getStorageSync("authorization")},data:{orderId:e.goods.id},success:function(o){console.log(o),t.requestPayment({provider:"wxpay",timeStamp:o.data.timeStamp,nonceStr:o.data.nonceStr,package:o.data.package,signType:"MD5",paySign:o.data.paySign,success:function(o){console.log("success:"+JSON.stringify(o)),e.paystate=0,t.navigateBack({delta:2})},fail:function(o){console.log("fail:"+JSON.stringify(o)),e.paystate=0,t.showModal({content:"确定要放弃本次支付吗？",success:function(e){e.confirm?t.navigateBack({delta:2}):e.cancel&&console.log("用户点击取消")}})}})},complete:function(t){}}))},bindDateChange:function(t){this.date=t.target.value},radioChange:function(t){var e=t.target.value;this.time=e,console.log(e)},stopPrevent:function(){}}};e.default=l}).call(this,o("543d")["default"])},f08f:function(t,e,o){}},[["0fc1","common/runtime","common/vendor"]]]);