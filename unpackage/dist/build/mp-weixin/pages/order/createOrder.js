(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/order/createOrder"],{"013b":function(e,t,o){},"217a":function(e,t,o){"use strict";o.r(t);var n=o("a928"),a=o("a9b6");for(var i in a)"default"!==i&&function(e){o.d(t,e,(function(){return a[e]}))}(i);o("6ed5");var s,u=o("f0c5"),d=Object(u["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],s);t["default"]=d.exports},"551e":function(e,t,o){"use strict";(function(e){o("c6bf"),o("921b");n(o("66fd"));var t=n(o("217a"));function n(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,o("543d")["createPage"])},"6ed5":function(e,t,o){"use strict";var n=o("013b"),a=o.n(n);a.a},"7d88":function(e,t,o){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(o("4795"));function a(e){return e&&e.__esModule?e:{default:e}}function i(e,t,o,n,a,i,s){try{var u=e[i](s),d=u.value}catch(c){return void o(c)}u.done?t(d):Promise.resolve(d).then(n,a)}function s(e){return function(){var t=this,o=arguments;return new Promise((function(n,a){var s=e.apply(t,o);function u(e){i(s,n,a,u,d,"next",e)}function d(e){i(s,n,a,u,d,"throw",e)}u(void 0)}))}}var u=function(){o.e("components/uni-number-box/uni-number-box").then(function(){return resolve(o("8ae1"))}.bind(null,o)).catch(o.oe)},d=function(){o.e("components/uni-section/uni-section").then(function(){return resolve(o("8a21"))}.bind(null,o)).catch(o.oe)},c=function(){o.e("components/uni-popup/uni-popup").then(function(){return resolve(o("5662"))}.bind(null,o)).catch(o.oe)};function r(e){var t=new Date,o=t.getFullYear(),n=t.getMonth()+1,a=t.getDate();return"start"===e||"end"===e&&(o+=2),n=n>9?n:"0"+n,a=a>9?a:"0"+a,"".concat(o,"-").concat(n,"-").concat(a)}var l={components:{uniPopup:c,uniNumberBox:u,uniSection:d},data:function(){return{paystate:0,goid:0,itemss:"",show:!1,oid:0,id:"",type:0,new_type:"",youhui:0,maskState:0,desc:"",payType:1,numberValue:1,minQuantity:1,price:0,all_price:0,secondKillId:0,secondKillTimeId:0,guige_id:0,miaosha:0,buy_type:0,couponSel:"",commodity:[],selCouponName:"选择优惠券",total:0,goods:[],service:[],note:"",date:r({format:!0}),time:"2",startDate:r("start"),endDate:r("end"),couponList:[],addressData:{name:"添加地址",mobile:null}}},onLoad:function(e){var t=this;t.paystate=0;var o=e.id,n=e.type,a=e.guige_id;console.log(a),t.numberValue=e.numberValue,t.id=e.id,t.type=e.type,t.guige_id=e.guige_id,t.buy_type=e.buy_type,t.loadData(o),0==n?t.new_type=2:1==n?t.new_type=0:2==n?t.new_type=6:-1==n?1==e.buy_type?t.new_type=1:t.new_type=0:-2==n?1==e.buy_type?t.new_type=7:t.new_type=6:-3==n&&(1==e.buy_type?t.new_type=3:t.new_type=2),1==e.miaosha&&(t.miaosha=e.miaosha,t.secondKillId=e.secondKillId,t.secondKillTimeId=e.secondKillTimeId,console.log("is秒杀"+e.miaosha),t.new_type=5)},methods:{onShareinfo:function(t){var o=this;e.showLoading({title:"数据生成中..."}),e.request({url:this.$api_url+"/user/createPoster",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded",authorization:e.getStorageSync("authorization")},data:{productId:this.id,type:this.type,secondKillId:"",secondKillTimeId:"",path:"pages/detail/goodsinfo?id="+this.id+"&type="+this.type+"&miaosha=0"},success:function(t){if(console.log(t),1e3==t.data.code){var n=t.data.content,a=o.id,i=o.type;console.log("+++"+a),console.log("+++"+i),e.navigateTo({url:"/pages/videoshare/new_file?imgurl="+n+"&shareimg="+o.goods.imageUrls[0].url+"&sharebiaoti="+o.goods.title+"(抢购价：￥"+o.price+")&id="+a+"&type="+i+"&miaosha=0"})}},complete:function(t){e.hideLoading(),this.show=!1}})},change:function(e){console.log(e),this.numberValue=e,this.all_price=this.price*e,this.countTotal()},loadData:function(e){var t=this;return s(n.default.mark((function e(){return n.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t,t.loadGoodsInfo();case 2:case"end":return e.stop()}}),e)})))()},selAddress:function(){var t=this;e.chooseAddress({success:function(o){t.addressData=o,t.goods.pickUp&&(t.addressData.provinceName=t.goods.pickUpAddress,t.addressData.cityName="",t.addressData.detailInfo="",e.showModal({title:"提示",content:"该商品为自提，请注意自提地址！",showCancel:!1,success:function(e){}})),console.log(o.userName),console.log(o.postalCode),console.log(o.provinceName),console.log(o.cityName),console.log(o.countyName),console.log(o.detailInfo),console.log(o.nationalCode),console.log(o.telNumber)}})},nobonus:function(){this.selCouponName="选择优惠券",this.couponSel="",this.maskState=0,this.youhui=0,this.all_price=this.price*this.numberValue,this.countTotal()},loadGoodsInfo:function(){var t=this;if(console.log("this.miaosha=="+t.miaosha),1==t.miaosha)var o="second_kill/detail",n={id:t.secondKillId,secondKillTimeId:t.secondKillTimeId},a=this.$Request.topost(o,n);else o=this.$api.goods.goodsinfo,n={productId:this.id,type:this.type},a=this.$Request.toget(o,n);a.then((function(o){console.log(o),1e3==o.code?(0!=t.type?(console.log(t.guige_id),t.commodity=o.content.commodityList[t.guige_id],t.minQuantity=o.content.commodityList[t.guige_id].minQuantity,1==t.buy_type?t.price=t.commodity.groupBuyPrice:t.buy_type>99?t.price=t.commodity.groupBuyPrice:1==t.miaosha?t.price=t.commodity.secondKillPrice:t.price=t.commodity.price):(t.minQuantity=1,t.price=o.content.discountPrice),t.countTotal(),t.goods=o.content,console.log(o),t.goods.pickUp&&(t.addressData.userName="自提商品",t.addressData.telNumber=e.getStorageSync("phone"),t.addressData.provinceName=t.goods.pickUpAddress,t.addressData.cityName="",t.addressData.countyName="",t.addressData.detailInfo=""),t.$Request.topost(t.$api.order.bonus_list,{productId:t.id,price:t.price*t.minQuantity}).then((function(e){1e3==e.code&&(t.couponList=e.content)})),t.$Request.topost(t.$api.order.bonus_best,{productId:t.id,price:t.price*t.minQuantity}).then((function(e){1e3==e.code&&(t.couponSel=e.content.id,t.youhui=e.content.money,t.selCouponName=e.content.name,t.selCoupon(e.content),t.countTotal())}))):e.navigateBack()}))},countTotal:function(){this.price*this.numberValue>this.youhui?this.total=(this.price*this.numberValue-this.youhui).toFixed(2):this.total=0},toggleMask:function(e){var t=this;this.$Request.topost(this.$api.order.bonus_list,{productId:this.id,price:this.all_price}).then((function(e){1e3==e.code&&(t.couponList=e.content)}));var o="show"===e?10:300,n="show"===e?1:0;this.maskState=2,setTimeout((function(){t.maskState=n}),o)},selCoupon:function(e){this.youhui=e.money,this.all_price=this.price*this.numberValue,this.countTotal(),this.selCouponName=e.name+"(￥"+e.money+"元)",this.couponSel=e.id,this.maskState=0},numberChange:function(e){this.number=e.number},changePayType:function(e){this.payType=e},buttonClicktuan:function(){this.show=!0},cancel:function(e){this.show=!1},change1:function(e){},submit:function(){var t=this,o=this;if(o.oid=0,null==o.addressData.telNumber)e.showToast({title:"请选择地址"});else{if(1==o.paystate)return;if(e.showLoading({title:"数据加载中..."}),o.paystate=1,console.log(JSON.stringify(o.commodity)),o.buy_type>99)var n=o.$api_url+"/group_buy/take_create_order",a={groupBuyOrderId:o.buy_type-100,groupBuyId:o.goods.id,commodityId:o.commodity.id,quantity:o.numberValue,otherInfo:o.note,consignee:o.addressData.userName,phone:o.addressData.telNumber,address:o.addressData.provinceName+o.addressData.cityName+o.addressData.countyName+o.addressData.detailInfo,bonusUserId:o.couponSel};else if(1==o.buy_type)n=o.$api_url+"/group_buy/create_order",a={groupBuyId:o.goods.id,commodityId:o.commodity.id,quantity:o.numberValue,otherInfo:o.note,consignee:o.addressData.userName,phone:o.addressData.telNumber,address:o.addressData.provinceName+o.addressData.cityName+o.addressData.countyName+o.addressData.detailInfo,bonusUserId:o.couponSel};else{n=o.$api_url+"/order/create";if(0==o.goods.type)a={type:o.new_type,commodityItemVO:{commodityId:o.goods.commodityId,quantity:o.numberValue},otherInfo:o.note,consignee:o.addressData.userName,phone:o.addressData.telNumber,address:o.addressData.provinceName+o.addressData.cityName+o.addressData.countyName+o.addressData.detailInfo,bonusUserId:o.couponSel};else a={type:o.new_type,commodityItemVO:{commodityId:o.commodity.id,quantity:o.numberValue},otherInfo:o.note,consignee:o.addressData.userName,phone:o.addressData.telNumber,address:o.addressData.provinceName+o.addressData.cityName+o.addressData.countyName+o.addressData.detailInfo,bonusUserId:o.couponSel}}e.request({url:n,method:"POST",header:{authorization:e.getStorageSync("authorization")},data:a,success:function(n){console.log(n),1e3==n.data.code?(o.oid=n.data.content.id,e.request({url:t.$api_url+"/weixin/payment.do",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded",authorization:e.getStorageSync("authorization")},data:{orderId:n.data.content.id},success:function(t){console.log(t),e.requestPayment({provider:"wxpay",timeStamp:t.data.timeStamp,nonceStr:t.data.nonceStr,package:t.data.package,signType:"MD5",paySign:t.data.paySign,success:function(t){console.log("success:"+JSON.stringify(t)),1==o.buy_type?o.buttonClicktuan():e.navigateBack({delta:2}),o.paystate=0},fail:function(t){console.log("fail:"+JSON.stringify(t)),o.paystate=0,e.redirectTo({url:"/pages/order/daizhifuOrder?id="+o.oid})}}),e.hideLoading()},complete:function(t){setTimeout((function(){e.hideLoading()}),300)}})):(o.paystate=0,e.hideLoading(),e.showModal({title:"提示",content:""+n.data.message,showCancel:!1,success:function(e){}}))},fail:function(t){o.paystate=0,setTimeout((function(){e.hideLoading()}),300)}})}},bindDateChange:function(e){this.date=e.target.value},radioChange:function(e){var t=e.target.value;this.time=t,console.log(t)},stopPrevent:function(){}}};t.default=l}).call(this,o("543d")["default"])},a928:function(e,t,o){"use strict";var n={"uni-number-box":function(){return o.e("components/uni-number-box/uni-number-box").then(o.bind(null,"8ae1"))},"uni-popup":function(){return o.e("components/uni-popup/uni-popup").then(o.bind(null,"5662"))}},a=function(){var e=this,t=e.$createElement;e._self._c},i=[];o.d(t,"b",(function(){return a})),o.d(t,"c",(function(){return i})),o.d(t,"a",(function(){return n}))},a9b6:function(e,t,o){"use strict";o.r(t);var n=o("7d88"),a=o.n(n);for(var i in n)"default"!==i&&function(e){o.d(t,e,(function(){return n[e]}))}(i);t["default"]=a.a}},[["551e","common/runtime","common/vendor"]]]);